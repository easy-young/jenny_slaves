<div>
    <nav class="">
        <div class="">
          <a class="" href="/"><img src="http://localhost:3000/logo-light.png"/></a>
          <button class="">
            <span class=""></span>
          </button>
          <div class="" id="">
            <ul class="">
              {% if userData %}
              <li class="">
                  <a class="" href="/board/write">글쓰기</a>
                </li>

            
                  <li class="">
                    <a class="" href="#" onclick="publicChatHandler(true)">전체채팅하기</a>
                  </li>

                  
              <li class="">
                <a class="" href="#" id="" >
                  Account
                </a>
                <ul class="" >
                  <li><a class=""  id="logout" href="">로그아웃</a></li>

                </ul>
              </li>
      
              {% else %}
          
              <li class="">
                  <a class="" href="#" id="" role="">
                    Account
                  </a>
                  <ul class="">
                    <li><a class=""  href="/user/login">로그인</a></li>
                  </ul>
                </li>
              {% endif %}
            </ul>
          
          </div>
        </div>
      </nav>

      <div class="">
        <div class="" id="">
            <div class="">
                <div class="">
                    <span>Public Chat </span>
                    <button class="" onclick="publicChatHandler(false)">close</button>
                </div>
                <div class="" id="chat-msg-box">
                    <ul id="chat" class="">

                    </ul>
                </div>
                <div class="card-footer">
                    <form action="/" method="get">
                        <div class="">
                            <input class="" type="text" name="input" id="input"/>
                            <button class="" type="submit">send</button>
                        </div>
                    </form>
                  
                 
                </div>
            </div>
         



        </div>
        
        <div class="private-chat-wrapper" id="private-chat-wrapper">
         1:1 chat
      </div>
      </div>
</div>

<style>
    .chat-wrapper{
        position: relative;
  
        transition: all ease .7s;
    }
    .private-chat-wrapper,
    .public-chat-wrapper{
        position: absolute;
        width:100%;
        height:500px;
        background-color: rgb(204, 204, 248);
        z-index: 2;
        top:-850px;
        transition: all ease .7s;

    }
    .private-chat-wrapper .card-body,
    .public-chat-wrapper .card-body {
        height:400px;
        overflow-y: scroll;
    }
    #chat{
        list-style: none;
    }
    #chat li{
        padding:8px 12px;
        margin-bottom: 3px;
        background-color: rgb(167, 255, 255);
        border-radius: 12px;
        color: rgb(9, 9, 49);
    }
  
  
</style>
<script>
    let isChat=true
    const publicChat = document.getElementById('public-chat-wrapper')
    const privateChat=document.getElementById('private-chat-wrapper')
    const publicChatHandler =()=>{
        if(isChat){
            isChat=false
            publicChat.style.top="0px"
        }else{
            isChat=true
            publicChat.style.top="-850px"
        }
        
    }
</script>



<script type="text/javascript">

        const chatMsgBox = document.getElementById('chat-msg-box')
        // 
    document.addEventListener('DOMContentLoaded',()=>{
        const webSocket = new WebSocket('ws://localhost:3006')
        webSocket.onopen = () => {
            console.log('웹소켓 Connection 성공 ( Handshake )')
            let welcomMent = {
                type:'welcom',
                data:{
                    nickname:'{{  userData.nickname  }}',
                }
            }

            webSocket.send(JSON.stringify(welcomMent))

        }

        webSocket.onclose = () => {
            console.log('웹소켓 disconnection')
        }
       

        const form = document.querySelector('form')
        form.addEventListener('submit', (e)=>{
            e.preventDefault()
           
            const{ input } = e.target
            let data = {
                type:'send_meg',
                data:{
                    nickname:'{{  userData.nickname  }}',
                    msg:input.value,
            
                }
            }

            
            webSocket.send(JSON.stringify(data))
            input.value = ''
            input.focus()
        })

        webSocket.onmessage = (event) => {

            const chat = document.querySelector('#chat')
            const liElement = document.createElement('li')
            liElement.classList=''
            liElement.innerHTML = event.data
            chat.appendChild(liElement)
            chatMsgBox.scrollTop = chatMsgBox.scrollHeight;
            console.log(event.data)
        }
    })
</script>




<script type="text/javascript">
    const logout = document.querySelector('#logout')
    
    logout.addEventListener('click', async (e)=>{
        e.preventDefault()

        const option = {
                'Content-type':'application/json',
                withCredentials:true,
        }

        const response = await axios.post('http://localhost:3000/user/logout',null,option)
        // const kakaoResponse = await axios.post('http://localhost:3000/user/kakaoLogout',null,option)
        
        alert(`로그아웃 되었습니다!!!!`)
        location.href = 'http://localhost:3001'
    })
</script>
  