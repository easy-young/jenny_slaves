<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- <link href="/user/join.css" type="text/css" rel="stylesheet"> -->

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>
        <a href="/">Logo</a>
    </h1>
    <h2>
        회원가입 페이지 입니다.
    </h2>
    <form method="post" action="/user/join" id="join_frm" enctype="multipart/form-data">
        <ul>
            <li>
                <strong>아이디</strong>
                <input type="text" name="userid" id="userid" minlength="4" maxlength="10">
            </li>
            <li>
                <strong>비밀번호</strong>
                <input type="text" name="userpw" id="userpw" minlength="4" maxlength="10">
            </li>
            <li>
                <strong>사진</strong>
                <input type="file" name="userimage" id="userimage">
            </li>
            <li>
                <strong>이름</strong>
                <input type="text" name="name" id="name" minlength="2" maxlength="10">
            </li>
            <li>
                <strong>닉네임</strong>
                <input type="text" name="nickname" id="nickname" minlength="2" maxlength="10">
            </li>
            <li>
                <strong>생년월일 :</strong>
                    <select id="year" name="year">
                        <option value="1985">1985년</option>
                        <option value="1986">1986년</option>
                        <option value="1987">1987년</option>
                        <option value="1988">1988년</option>
                        <option value="1989">1989년</option>
                        <option value="1990">1990년</option>
                        <option value="1991">1991년</option>
                        <option value="1992">1992년</option>
                        <option value="1993">1993년</option>
                        <option value="1994">1994년</option>
                        <option value="1995">1995년</option>
                        <option value="1996">1996년</option>
                        <option value="1997">1997년</option>
                        <option value="1998">1998년</option>
                        <option value="1999">1999년</option>
                        <option value="2000">2000년</option>
                        <option value="2001">2001년</option>
                        <option value="2002">2002년</option>
                        <option value="2003">2003년</option>
                        <option value="2004">2004년</option>
                        <option value="2005">2005년</option>
                        <option value="2006">2006년</option>
                        <option value="2007">2007년</option>
                        <option value="2008">2008년</option>
                        <option value="2009">2009년</option>
                        <option value="2010">2000년</option>
                        <option value="2011">2011년</option>
                        <option value="2012">2012년</option>
                        <option value="2013">2013년</option>
                        <option value="2014">2014년</option>
                        <option value="2015">2015년</option>
                    </select>
                    <select id="month" name="month">
                        <option value="01">1월</option>
                        <option value="02">2월</option>
                        <option value="03">3월</option>
                        <option value="04">4월</option>
                        <option value="05">5월</option>
                        <option value="06">6월</option>
                        <option value="07">7월</option>
                        <option value="08">8월</option>
                        <option value="09">9월</option>
                        <option value="10">10월</option>
                        <option value="11">11월</option>
                        <option value="12">12월</option>
                    </select>
                    <select id="day" name="day">
                        <option value="01">1일</option>
                        <option value="02">2일</option>
                        <option value="03">3일</option>
                        <option value="04">4일</option>
                        <option value="05">5일</option>
                        <option value="06">6일</option>
                        <option value="07">7일</option>
                        <option value="08">8일</option>
                        <option value="09">9일</option>
                        <option value="10">10일</option>
                        <option value="11">11일</option>
                        <option value="12">12일</option>
                        <option value="13">13일</option>
                        <option value="14">14일</option>
                        <option value="15">15일</option>
                        <option value="16">16일</option>
                        <option value="17">17일</option>
                        <option value="18">18일</option>
                        <option value="19">19일</option>
                        <option value="20">20일</option>
                        <option value="21">21일</option>
                        <option value="22">22일</option>
                        <option value="23">23일</option>
                        <option value="24">24일</option>
                        <option value="25">25일</option>
                        <option value="26">26일</option>
                        <option value="27">27일</option>
                        <option value="28">28일</option>
                        <option value="29">29일</option>
                        <option value="30">30일</option>
                        <option value="31">31일</option>
                    </select>
            </li>
            <li>
                <strong>주소</strong>
                <input type="text" name="address" minlength="4" id="address">
            </li>
            <li>
                <strong>성별</strong>
                <input type="radio" name="gender" id="genderM" value="M">남자
                <input type="radio" name="gender" id="genderF" value="F" checked="checked">여자
            </li>
            <li>
                <strong>집전화 :</strong>
                <input type="text" name="tel1" id="tel1" minlength="2" maxlength="3"> -
                <input type="text" name="tel2" id="tel2" minlength="3" maxlength="4"> -
                <input type="text" name="tel3" id="tel3" minlength="4" maxlength="4">
            </li>
            <li>
                <strong>핸드폰번호 :</strong>
                <input type="text" name="phone1" id="phone1" minlength="3" maxlength="3"> -
                <input type="text" name="phone2" id="phone2" minlength="4" maxlength="4"> -
                <input type="text" name="phone3" id="phone3" minlength="4" maxlength="4">
            </li>
            <li>
                <strong>E-mail</strong>
                <input type="text" name="email1" id="email1" minlength="4"> @
                <input type="text" name="email2" id="email2" minlength="4">
                <select id="email_select">
                    <option id="hanmail.net">hanmail.net</option>
                    <option id="gmail.com">gmail.com</option>
                    <option id="naver.com">naver.com</option>
                    <option id="또뭐있냐?.com">또뭐있냐?.com</option>
                </select>
            </li>
            <li>
                <strong>소개글</strong>
                <input type="text" name="intro" id="intro" minlength="4" >
            </li>
        </ul>
        <input type="submit" value="회원가입하기">
    </form>

    <script type="text/javascript">

        // 로그인상태에서 /user/join 못들어감
        async function asdf(){
            const option = {
                'Content-type':'application/json',
                withCredentials:true,
            }

            const response = await axios.post('http://localhost:3000/user/auth',null,option)
            const {errno} = response.data
            if(errno == 1) {
                alert('로그아웃 먼저 하고오세요')
                location.href = 'http://localhost:3001/'
            }
        }
        asdf()
        
        const emailSelect = document.querySelector('#email_select')
        emailSelect.addEventListener('click',(e)=>{
            let email2Value = document.querySelector('#email2')
            email2Value.value = e.target.value
        })

        const frm = document.querySelector('#join_frm')

        frm.addEventListener('submit',async (e)=>{
            e.preventDefault()
            const userid = document.querySelector('#userid').value
            const userpw = document.querySelector('#userpw').value
            const userimage = document.querySelector('#userimage').files[0]
            const name = document.querySelector('#name').value
            const nickname = document.querySelector('#nickname').value
            const year = document.querySelector('#year').value
            const month = document.querySelector('#month').value
            const day = document.querySelector('#day').value
            const address = document.querySelector('#address').value
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const tel1= document.querySelector('#tel1').value
            const tel2 = document.querySelector('#tel2').value
            const tel3 = document.querySelector('#tel3').value
            const phone1 = document.querySelector('#phone1').value
            const phone2 = document.querySelector('#phone2').value
            const phone3 = document.querySelector('#phone3').value
            const email1 = document.querySelector('#email1').value
            const email2 = document.querySelector('#email2').value
            const intro = document.querySelector('#intro').value

            const email = email1+'@'+email2
            const birth = year+month+day
            const tel = tel1+tel2+tel3
            const phone = phone1+phone2+phone3

                        
            const formData = new FormData();
            formData.append('userimage', userimage);
            formData.append('userid', userid);
            formData.append('userpw', userpw);
            formData.append('name', name);
            formData.append('nickname', nickname);
            formData.append('birth', birth);
            formData.append('address', address);
            formData.append('gender', gender);
            formData.append('tel', tel);
            formData.append('phone', phone);
            formData.append('email', email);
            formData.append('intro', intro);

            try{
                if(userimage == undefined || userid=='' || userpw=='' || name=='' || nickname=='' || year=='' || month=='' ||
                   day=='' || gender=='' || email1=='' || email2=='' || intro=='') throw new Error

                const body = formData

                const option = {
                    'Content-type':'application/json',
                    withCredentials:true,
                }

                const response = await axios.post('http://localhost:3000/user/join',body,option)
                const {errno} = response.data
                console.log(errno)

                if(errno == 1) alert('닉넴이나 아이디 중복이에요')
                if(errno == 2) alert('생년월일 다시확인하세요')
                if(errno == 0) location.href='http://localhost:3001/user/welcome'
            } catch(e){
                alert('빈값 다 채우세요오')
            }
        })
    </script>
</body>
</html>