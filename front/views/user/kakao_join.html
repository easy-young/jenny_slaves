<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="/user/kakaoJoin.css" type="text/css" rel="stylesheet">

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <header>
        <h1>
            오세요~ 이쪽이에요!
        </h1>
        <h2>오이마켓 회원가입</h2>
    </header>
    <form method="post" action="http://localhost:3000/user/kakaoJoin" id="join_frm" enctype="multipart/form-data">
        <ul>
            <li>
                <span id="userimage"><img src="{{userimage}}"></span>
            </li>
            <ul>
                <li>
                    <div><strong>닉네임 : <span id="nickname">{{nickname}}</span></strong></div>
                </li>
                <li id="email">
                    <div><strong>E-mail : <span id="email">{{email}}</span></strong></div>
                </li>
            </ul>
            <li>
                <div><strong>아이디</strong></div>
                <input type="text" name="userid" id="userid" minlength="4" maxlength="10" placeholder="아이디 입력 (4~10글자)">
            </li>
            <li>
                <div><strong>비밀번호</strong></div>
                <input type="text" name="userpw" id="userpw" minlength="4" maxlength="10" placeholder="비밀번호 입력 (4~10글자)">
            </li>
            
            <li>
                <div><strong>이름</strong></div>
                <input type="text" name="name" id="name" minlength="2" maxlength="10" placeholder="이름 입력 (1~5글자)">
            </li>
            <li>
                <div><strong>생년월일</strong></div>
                    <select id="year" name="year">
                        <option value="1999">1999년</option>
                        <option value="2000">2000년</option>
                        <option value="2001">2001년</option>
                        <option value="2002">2002년</option>
                    </select>
                    <select id="month" name="month">
                        <option value="01">1월</option>
                        <option value="02">2월</option>
                    </select>
                    <select id="day" name="day">
                        <option value="01">1일</option>
                        <option value="02">2일</option>
                        <option value="03">3일</option>
                    </select>
            </li>
            <li>
                <div><strong>주소</strong></div>
                <input type="text" name="address" minlength="4" id="address" placeholder="주소 입력">
            </li>
            <li id="gender">
                <div><strong>성별</strong></div>
                <input type="radio" name="gender" id="genderM" value="M"><label for="genderM">남자</label>
                <input type="radio" name="gender" id="genderF" value="F" checked="checked"><label for="genderF">여자</label>
            </li>
            <li id="tel">
                <div><strong>집전화</strong></div>
                <input type="text" name="tel" id="tel1" minlength="2" maxlength="3"><strong> -</strong>
                <input type="text" name="tel" id="tel2" minlength="3" maxlength="4"><strong> -</strong>
                <input type="text" name="tel" id="tel3" minlength="4" maxlength="4">
            </li>
            <li id="phone">
                <div><strong>핸드폰번호</strong></div>
                <input type="text" name="phone" id="phone1" minlength="3" maxlength="3"><strong> -</strong>
                <input type="text" name="phone" id="phone2" minlength="4" maxlength="4"><strong> -</strong>
                <input type="text" name="phone" id="phone3" minlength="4" maxlength="4">
            </li>
            <li>
                <div><strong>소개글</strong></div>
                <textarea name="intro" id="intro" cols="30" rows="10" minlength="4" placeholder="소개를 입력해주세요."></textarea>
            </li>
        </ul>
        <div id="submitBox">
            <a href="/">뒤로 가기</a>
            <input type="submit" id="submit" value="회원가입">
        </div>
    </form>

    <script type="text/javascript">
        const frm = document.querySelector('#join_frm')

        frm.addEventListener('submit',async (e)=>{
            e.preventDefault()
            const userid = document.querySelector('#userid').value
            const userpw = document.querySelector('#userpw').value
            const userimage = document.querySelector('#userimage').innerHTML
            const name = document.querySelector('#name').value
            const nickname = document.querySelector('#nickname').innerHTML
            const year = document.querySelector('#year').value
            const month = document.querySelector('#month').value
            const day = document.querySelector('#day').value
            const address = document.querySelector('#address').value
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const tel1= document.querySelector('#tel1').value
            const tel2 = document.querySelector('#tel2').value
            const tel3 = document.querySelector('#tel3').value
            const phone1 = document.querySelector('#phone1').value
            const phone2 = document.querySelector('#phone2').value
            const phone3 = document.querySelector('#phone3').value
            const email = document.querySelector('#email').innerHTML
            const intro = document.querySelector('#intro').value

            try {
                if(userid=='' || userpw=='' || name=='' || year=='' || month=='' || day=='' ||
                   gender=='' || address =='' || tel1=='' || tel2=='' || tel3=='' || phone1=='' ||
                   phone2=='' || phone3=='' || intro=='') throw new Error

                const body = {
                    userid,
                    userpw,
                    userimage,
                    name,
                    nickname,
                    birth:[year,month,day],
                    address,
                    gender,
                    tel:[tel1,tel2,tel3],
                    phone:[phone1,phone2,phone3],
                    email,
                    intro
                }

                const option = {
                    'Content-type':'application/json',
                    withCredentials:true,
                }
                
                const response = await axios.post('http://localhost:3000/user/kakaoJoin',body,option)
                if(response.data.errno === 0){
                    location.href = 'http://localhost:3001/user/welcome'
                }
            } catch (e) {
                console.log(e.messege)
                alert('빈값 다 채우세요')
            }
        })
    </script>
</body>
</html>